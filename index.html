<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoTrade - Trade</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>
    <main class="main-content">
        <!-- PAGE HEADER -->
        <section class="page-header">
            <h1 class="page-title">Trade</h1>
            <p class="page-subtitle">Execute trades instantly</p>
        </section>

        <!-- BALANCE -->
        <section class="balance-section">
            <div class="balance-card">
                <div class="balance-label">Virtual Balance</div>
                <div class="balance-amount">₹98,450</div>
                <span class="balance-change positive">+2.6%</span>
            </div>
        </section>

        <!-- CANDLE CHART -->
        <section class="candle-chart-section">
            <div class="chart-header">
                <h2 class="chart-title" id="chartTitle">RELIANCE <span id="timeframeLabel">1D</span></h2>
                <div class="timeframe-selector">
                    <button class="timeframe-btn active" data-timeframe="1m">1m</button>
                    <button class="timeframe-btn" data-timeframe="5m">5m</button>
                    <button class="timeframe-btn" data-timeframe="15m">15m</button>
                    <button class="timeframe-btn" data-timeframe="1h">1h</button>
                    <button class="timeframe-btn active" data-timeframe="1d">1D</button>
                    <button class="timeframe-btn" data-timeframe="1w">1W</button>
                    <button class="timeframe-btn" data-timeframe="1M">1M</button>
                </div>
            </div>
            <div id="tradingview_candle" class="candle-chart">
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #b8b8d9;">
                  
                </div>
            </div>
        </section>

        <!-- STOCK SELECTOR -->
        <section class="stock-selector-section">
            <h2 class="section-title">Select Stock</h2>
            <div class="stock-grid">
                <div class="stock-option active" data-symbol="RELIANCE">
                    <div class="stock-symbol">RELIANCE</div>
                    <div class="stock-price">₹2,945</div>
                    <div class="stock-change positive">+1.8%</div>
                </div>
                <div class="stock-option" data-symbol="TCS">
                    <div class="stock-symbol">TCS</div>
                    <div class="stock-price">₹4,120</div>
                    <div class="stock-change negative">-0.5%</div>
                </div>
                <div class="stock-option" data-symbol="HDFCBANK">
                    <div class="stock-symbol">HDFCBANK</div>
                    <div class="stock-price">₹1,675</div>
                    <div class="stock-change positive">+2.1%</div>
                </div>
            </div>
        </section>

        <!-- STOCK LIST -->
        <section class="stock-list-section">
            <h2 class="section-title">Live Stocks</h2>
            <div class="stock-list">
                <div class="stock-item">
                    <div class="stock-symbol">RELIANCE</div>
                    <div class="stock-change positive">+1.8%</div>
                    <div class="stock-price">₹2,945</div>
                </div>
                <div class="stock-item">
                    <div class="stock-symbol">TCS</div>
                    <div class="stock-change negative">-0.5%</div>
                    <div class="stock-price">₹4,120</div>
                </div>
                <div class="stock-item">
                    <div class="stock-symbol">HDFCBANK</div>
                    <div class="stock-change positive">+2.1%</div>
                    <div class="stock-price">₹1,675</div>
                </div>
            </div>
        </section>

        <!-- TRADE FORM -->
        <section class="trade-form-section">
            <form class="trade-form">
                <div class="form-group">
                    <label>Stock</label>
                    <select class="form-input" id="tradeStock">
                        <option value="RELIANCE">RELIANCE</option>
                        <option value="TCS">TCS</option>
                        <option value="HDFCBANK">HDFCBANK</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" class="form-input" value="10">
                    </div>
                    <div class="form-group">
                        <label>Price</label>
                        <input type="number" class="form-input" value="2945">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="trade-button buy-button">BUY</button>
                    <button type="button" class="trade-button sell-button">SELL</button>
                </div>
            </form>
        </section>

        <!-- TRADE HISTORY -->
        <section class="trade-history-section">
            <h2 class="section-title">Recent Trades</h2>
            <div class="trade-history">
                <div class="trade-item">
                    <div>
                        <div class="stock-symbol">RELIANCE</div>
                        <span class="trade-buy">BUY 50 @ ₹2,930</span>
                    </div>
                    <div>₹1,46,500</div>
                </div>
                <div class="trade-item">
                    <div>
                        <div class="stock-symbol">TCS</div>
                        <span class="trade-sell">SELL 20 @ ₹4,110</span>
                    </div>
                    <div>₹82,200</div>
                </div>
            </div>
        </section>
    </main>

    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
        <a href="Index.html" class="nav-item active">
            <i class="ii"></i>
            <span>Trade</span>
        </a>
        <a href="portfolio.html" class="nav-item">
            <i class="ii"></i>
            <span>Portfolio</span>
        </a>
        <a href="Profile.html" class="nav-item">
            <i class="ii"></i>
            <span>Profile</span>
        </a>
    </nav>

    <script>
        let chart, candlestickSeries;
        let currentSymbol = 'RELIANCE';
        let currentTimeframe = '1d';
        const stockPrices = {
            'RELIANCE': 2945,
            'TCS': 4120,
            'HDFCBANK': 1675
        };

        // Wait for page to fully load
        window.addEventListener('load', function() {
            initCandleChart();
        });

        function initCandleChart() {
            const chartContainer = document.getElementById('tradingview_candle');
            if (!chartContainer || typeof LightweightCharts === 'undefined') {
                setTimeout(initCandleChart, 500);
                return;
            }

            // Generate realistic RELIANCE data - 60 candles
            const data = generateCandleData(stockPrices[currentSymbol], currentTimeframe);

            // Create chart
            chart = LightweightCharts.createChart(chartContainer, {
                width: chartContainer.clientWidth,
                height: 360,
                layout: {
                    background: { color: 'transparent' },
                    textColor: '#b8b8d9',
                },
                grid: {
                    vertLines: {
                        color: 'rgba(0, 212, 255, 0.1)',
                        style: LightweightCharts.LineStyle.Dashed
                    },
                    horzLines: {
                        color: 'rgba(0, 212, 255, 0.1)',
                        style: LightweightCharts.LineStyle.Dashed
                    },
                },
                timeScale: {
                    timeVisible: true,
                    secondsVisible: false,
                    borderColor: 'rgba(0, 212, 255, 0.3)',
                },
                rightPriceScale: {
                    borderColor: 'rgba(0, 212, 255, 0.3)',
                },
                crosshair: {
                    mode: LightweightCharts.CrosshairMode.Normal,
                },
                handleScroll: true,
                handleScale: true,
            });

            // Candlestick series with neon colors
            candlestickSeries = chart.addCandlestickSeries({
                upColor: '#00ff88',
                downColor: '#ff4766',
                borderDownColor: '#ff4766',
                borderUpColor: '#00ff88',
                wickDownColor: '#ff4766',
                wickUpColor: '#00ff88',
                borderVisible: false,
            });

            candlestickSeries.setData(data);

            // Auto-fit and resize
            setTimeout(() => chart.timeScale().fitContent(), 100);

            // Handle window resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    chart.applyOptions({ width: chartContainer.clientWidth });
                }, 100);
            });
        }

        function generateCandleData(basePrice, timeframe) {
            const data = [];
            const candleCount = getCandleCount(timeframe);
            const startDate = new Date('2025-12-01');
            
            for (let i = 0; i < candleCount; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() - i);
                
                const variation = Math.sin(i * 0.3) * 80 + (Math.random() - 0.5) * 40;
                const open = basePrice + variation + (Math.random() - 0.5) * 20;
                const close = open + (Math.random() - 0.5) * 30;
                const high = Math.max(open, close) + Math.random() * 15;
                const low = Math.min(open, close) - Math.random() * 15;

                data.unshift({
                    time: Math.floor(date.getTime() / 1000),
                    open: Math.round(open * 100) / 100,
                    high: Math.round(high * 100) / 100,
                    low: Math.round(low * 100) / 100,
                    close: Math.round(close * 100) / 100,
                });
            }
            return data;
        }

        function getCandleCount(timeframe) {
            const counts = {
                '1m': 60,
                '5m': 48,
                '15m': 48,
                '1h': 24,
                '1d': 60,
                '1w': 52,
                '1M': 12
            };
            return counts[timeframe] || 60;
        }

        // Stock selector functionality
        document.querySelectorAll('.stock-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.stock-option').forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                
                currentSymbol = this.dataset.symbol;
                document.getElementById('chartTitle').textContent = currentSymbol;
                document.getElementById('tradeStock').value = currentSymbol;
                
                if (chart && candlestickSeries) {
                    const data = generateCandleData(stockPrices[currentSymbol], currentTimeframe);
                    candlestickSeries.setData(data);
                    setTimeout(() => chart.timeScale().fitContent(), 100);
                }
            });
        });

        // Timeframe selector functionality
        document.querySelectorAll('.timeframe-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                currentTimeframe = this.dataset.timeframe;
                document.getElementById('timeframeLabel').textContent = currentTimeframe.toUpperCase();
                
                if (chart && candlestickSeries) {
                    const data = generateCandleData(stockPrices[currentSymbol], currentTimeframe);
                    candlestickSeries.setData(data);
                    setTimeout(() => chart.timeScale().fitContent(), 100);
                }
            });
        });

        // Trade form stock sync
        document.getElementById('tradeStock').addEventListener('change', function() {
            currentSymbol = this.value;
            document.getElementById('chartTitle').textContent = currentSymbol;
            document.querySelectorAll('.stock-option').forEach(opt => {
                opt.classList.toggle('active', opt.dataset.symbol === currentSymbol);
            });
        });
    </script>

    <style>
        /* ADDITIONAL STYLES FOR NEW FEATURES */
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .chart-title {
            margin: 0;
            font-size: 24px;
            font-weight: bold;
        }

        .timeframe-selector {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .timeframe-btn {
            padding: 8px 12px;
            border: 2px solid rgba(0, 212, 255, 0.3);
            background: transparent;
            color: #b8b8d9;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timeframe-btn.active,
        .timeframe-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: rgba(0, 212, 255, 0.6);
            color: #00ff88;
        }

        .stock-selector-section {
            margin: 20px 0;
        }

        .stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .stock-option {
            padding: 15px;
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0, 0, 0, 0.3);
        }

        .stock-option.active,
        .stock-option:hover {
            border-color: rgba(0, 212, 255, 0.8);
            background: rgba(0, 212, 255, 0.1);
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.2);
        }

        .stock-symbol {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stock-price {
            font-size: 18px;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 5px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .chart-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .timeframe-selector {
                width: 100%;
                justify-content: center;
            }
            
            .stock-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</body>
</html>
